<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta http-equiv=X-UA-Compatible content="IE=edge"> <meta name=viewport content="width=device-width, initial-scale=1"> <title>New Widgets Part 2 | Cabbage Audio</title> <meta name=description content="Cabbage is a framework for audio software development. Using simple markup text and the Csound audio synthesis language users can target four major operating..."> <link rel=canonical href="index.html"> <link rel=alternate type=application/rss+xml title="Cabbage Audio" href=http://cabbageaudio.com/feed.xml> <link rel=apple-touch-icon sizes=57x57 href=http://cabbageaudio.com/apple-touch-icon-57x57.png> <link rel=apple-touch-icon sizes=60x60 href=http://cabbageaudio.com/apple-touch-icon-60x60.png> <link rel=apple-touch-icon sizes=72x72 href=http://cabbageaudio.com/apple-touch-icon-72x72.png> <link rel=apple-touch-icon sizes=76x76 href=http://cabbageaudio.com/apple-touch-icon-76x76.png> <link rel=apple-touch-icon sizes=114x114 href=http://cabbageaudio.com/apple-touch-icon-114x114.png> <link rel=apple-touch-icon sizes=120x120 href=http://cabbageaudio.com/apple-touch-icon-120x120.png> <link rel=apple-touch-icon sizes=144x144 href=http://cabbageaudio.com/apple-touch-icon-144x144.png> <link rel=apple-touch-icon sizes=152x152 href=http://cabbageaudio.com/apple-touch-icon-152x152.png> <link rel=apple-touch-icon sizes=180x180 href=http://cabbageaudio.com/apple-touch-icon-180x180.png> <link rel=icon type=image/png href=http://cabbageaudio.com/favicon-32x32.png sizes=32x32> <link rel=icon type=image/png href=http://cabbageaudio.com/favicon-194x194.png sizes=194x194> <link rel=icon type=image/png href=http://cabbageaudio.com/favicon-96x96.png sizes=96x96> <link rel=icon type=image/png href=http://cabbageaudio.com/android-chrome-192x192.png sizes=192x192> <link rel=icon type=image/png href=http://cabbageaudio.com/favicon-16x16.png sizes=16x16> <link rel=manifest href=http://cabbageaudio.com/manifest.json> <link rel=mask-icon href=http://cabbageaudio.com/safari-pinned-tab.svg color=#93d200> <meta name=apple-mobile-web-app-title content="Cabbage Audio"> <meta name=application-name content="Cabbage Audio"> <meta name=msapplication-TileColor content=#24b1f2> <meta name=msapplication-TileImage content=http://cabbageaudio.com/mstile-144x144.png> <meta name=theme-color content=#0391d1> <link rel=stylesheet href="../../styles/main.css"> </head> <body class=docs> <div class=wrapper> <header class=navigation role=banner> <div class=navigation-wrapper> <a href="http://cabbageaudio.com/" class=logo-header> <img src="../../images/cabbage_transparent.svg" alt="Cabbage Logo"> </a> <a href=javascript:void(0) class=navigation-menu-button id=js-mobile-menu>MENU</a> <nav role=navigation> <ul id=js-navigation-menu class="navigation-menu show"> <li class=nav-link> <a href="http://cabbageaudio.com/" title=Home>Home</a> </li> <li class=nav-link> <a href=http://cabbageaudio.com/#features title=Features>Features</a> </li> <li class=nav-link> <a href="http://cabbageaudio.com/download/" title=Download>Download</a> </li> <li class="nav-link more"> <a href="http://cabbageaudio.com/" title=Learning>Learning</a> <ul class=submenu> <li> <a href="../introduction/index.html" title=Docs>Docs</a> </li> <li> <a href="http://cabbageaudio.com/tutorials/" title=Videos>Videos</a> </li> </ul> </li> <li class=nav-link> <a href="http://cabbageaudio.com/faq/" title=FAQ>FAQ</a> </li> <li class=nav-link> <a href=http://forum.cabbageaudio.com title=Forum target=_blank>Forum</a> </li> </ul> </nav> </div> </header> <!--[if lt IE 11]>
 <p class="browserupgrade">You are using an <strong>outdated</strong> browser. The CabbageAudio site may not display correctly. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
 <![endif]--> <aside class=doc-nav> <nav role=navigation id=doc-menu> <h3>Cabbage Docs</h3> <hr> <ul> <li> <a href=http://cabbageaudio.com/docs/intro class=sub-menu-trigger> <i class=icon-right-open></i>&nbsp; Quickstart </a> <ul class=submenu> <li><a href="../introduction/index.html">Introduction</a></li> <li><a href="../standalone_host/index.html">Standalone Host</a></li> <li><a href="../first_synth/index.html">First Synth</a></li> <li><a href="../controlling/index.html">Controlling</a></li> <li><a href="../first_effect/index.html">First Effect</a></li> <li><a href="../exporting/index.html">Exporting</a></li> <li><a href="../distributing/index.html">Distributing</a></li> <li><a href="../cabbage_studio/index.html">Cabbage Studio</a></li> <li><a href="../android/index.html">Android</a></li> <li><a href="../cabbage_audio_unit/index.html">Cabbage Audio Unit</a></li> </ul> </li> </ul> <ul> <li> <a href=http://cabbageaudio.com class=sub-menu-trigger> <i class=icon-right-open></i>&nbsp; Cabbage Widgets </a> <ul class=submenu> <li><a href="../cabbage_syntax/index.html">Cabbage Syntax</a></li> <li><a href="../button/index.html">Button</a></li> <li><a href="../button_file/index.html">Button File</a></li> <li><a href="../button_info/index.html">Button Info</a></li> <li><a href="../checkbox/index.html">Checkbox</a></li> <li><a href="../combobox/index.html">Combobox</a></li> <li><a href="../csound_output/index.html">Csound Output</a></li> <li><a href="../encoder/index.html">Encoder</a></li> <li><a href="../gentable/index.html">Gentable</a></li> <li><a href="../hrange/index.html">Hrange</a></li> <li><a href="../fftdisplay/index.html">Fftdisplay</a></li> <li><a href="../form/index.html">Form</a></li> <li><a href="../groupbox/index.html">Groupbox</a></li> <li><a href="../image/index.html">Image</a></li> <li><a href="../keyboard/index.html">Keyboard</a></li> <li><a href="../label/index.html">Label</a></li> <li><a href="../numberbox/index.html">Numberbox</a></li> <li><a href="../sliders/index.html">Sliders</a></li> <li><a href="../soundfiler/index.html">Soundfiler</a></li> <li><a href="../table/index.html">Table</a></li> <li><a href="../textbox/index.html">Textbox</a></li> <li><a href="../texteditor/index.html">Texteditor</a></li> <li><a href="../vrange/index.html">Vrange</a></li> <li><a href="../xypad/index.html">Xypad</a></li> </ul> </li> </ul> <ul> <li> <a href=http://cabbageaudio.com class=sub-menu-trigger> <i class=icon-right-open></i>&nbsp; Extras </a> <ul class=submenu> <li><a href="../identchannels/index.html">Identchannels</a></li> <li><a href="../plants/index.html">Plants</a></li> <li><a href="../presets/index.html">Presets</a></li> <li><a href="../gui_designer/index.html">Gui Designer</a></li> <li><a href="../widget_arrays/index.html">Widget Arrays</a></li> <li><a href="../managing_large_numbers_of_widgets/index.html">Managing Large Numbers Of Widgets</a></li> <li><a href="../macros_and_reserved_channels/index.html">Macros And Reserved Channels</a></li> <li><a href="../using_svgs/index.html">Using Svgs</a></li> </ul> </li> </ul> <ul> <li> <a href=http://cabbageaudio.com class=sub-menu-trigger> <i class=icon-right-open></i>&nbsp; Csound </a> <ul class=submenu> <li><a href="../csound_syntax/index.html">Csound Syntax</a></li> <li><a href="../keywords/index.html">Keywords</a></li> <li><a href="../contants_and_variables/index.html">Contants And Variables</a></li> <li><a href="../opcodes/index.html">Opcodes</a></li> <li><a href="../operators_and_comments/index.html">Operators And Comments</a></li> <li><a href="../beginner_synth/index.html">Beginner Synth</a></li> </ul> </li> </ul> <ul class=active-sub-item> <li> <a href=http://cabbageaudio.com class=sub-menu-trigger> <i class="icon-right-open active-sub-item"></i>&nbsp; Extending Cabbage </a> <ul class=submenu> <li><a href="../new_widgets_part_1/index.html">New Widgets Part 1</a></li> <li class=current><a href="index.html">New Widgets Part 2</a></li> <li><a href="../new_widgets_part_3/index.html">New Widgets Part 3</a></li> </ul> </li> </ul> </nav> </aside> <div class=doc-content> <i class="toggle-nav icon icon-menu">&#xe81b;</i> <div class=container> <article class=post>  <div class=post-content> <h1>New Widgets, Part 2</h1> <p>Now that we have created our simple widget, and have tested to make sure it works, we can move on to adding some functionality to it. Our simple widget will serve as a single-track step sequencer. Users should be able to specify the number of steps in the sequence, as well as speed of &#39;playback&#39;. </p> <h3>Adding new custom identifiers</h3> <p>As there are currently no pre-existing identifiers that can be used for the aforementioned two properties, we will need to create them ourselves by adding them to the IdentArray class in CabbageGUIClass.h. </p> <div class=highlight><pre><code class=language-csharp data-lang=csharp><span class=c1>// this array holds the name of identifiers used in Cabbage syntx
</span><span class=k>class</span> <span class=nc>IdentArray</span> <span class=p>:</span> <span class=k>public</span> <span class=n>StringArray</span>
<span class=p>{</span>
<span class=k>public</span><span class=p>:</span>
    <span class=nf>IdentArray</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>add</span><span class=p>(</span><span class=s>"numberofsteps"</span><span class=p>)</span>
        <span class=k>add</span><span class=p>(</span><span class=s>"stepbpm"</span><span class=p>)</span>
<span class=p>(...)</span>
</code></pre></div> <p>We then need to add some code to the CabbageGUIType::parse(...) method. You&#39;ll see that this method contains a number of conditional statements relating to numeric, or string parameters. In the if-else&#39;s for numeric parameters we add the following code:</p> <div class=highlight><pre><code class=language-csharp data-lang=csharp><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>identArray</span><span class=p>[</span><span class=n>indx</span><span class=p>].</span><span class=nf>equalsIgnoreCase</span><span class=p>(</span><span class=s>"numberofsteps"</span><span class=p>))</span>
<span class=p>{</span>
    <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=k>set</span><span class=p>(</span><span class=s>"numberofsteps"</span><span class=p>,</span> <span class=n>strTokens</span><span class=p>[</span><span class=m>0</span><span class=p>].</span><span class=nf>trim</span><span class=p>().</span><span class=nf>getIntValue</span><span class=p>());</span>
<span class=p>}</span>

<span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>identArray</span><span class=p>[</span><span class=n>indx</span><span class=p>].</span><span class=nf>equalsIgnoreCase</span><span class=p>(</span><span class=s>"stepbpm"</span><span class=p>))</span>
<span class=p>{</span>
    <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=k>set</span><span class=p>(</span><span class=s>"stepbpm"</span><span class=p>,</span> <span class=n>strTokens</span><span class=p>[</span><span class=m>0</span><span class=p>].</span><span class=nf>trim</span><span class=p>().</span><span class=nf>getIntValue</span><span class=p>());</span>
<span class=p>}</span>
</code></pre></div> <p>The CabbageGUIType::parse(...) method is passed a line of Cabbage code, and from that code it sets each of the widget&#39;s identifiers. The above code checks if the line contains a <em>numberofsteps</em>, or <em>stepbpm</em> identifier. If it does, Cabbage will set the value of the identifier with the number passed to it in the user&#39;s Cabbage code. </p> <blockquote> <p>It&#39;s worth checking the list of existing Cabbage identifiers before creating new ones. In many cases, pre-existing identifiers can be used. For example, we don&#39;t need to create a special <code>steppercolour()</code> identifier for our new widget. We can just use the pre-existing colour() identifier instead. </p> </blockquote> <p>Now that we have added two unique stepper identifiers, we might as well go ahead and add default values for them in the CabageGUIType class constructor. </p> <div class=highlight><pre><code class=language-csharp data-lang=csharp>    <span class=p>(...)</span>
    <span class=c1>//===============stepper==================//
</span>    <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>strTokens</span><span class=p>[</span><span class=m>0</span><span class=p>].</span><span class=nf>trim</span><span class=p>()</span> <span class=p>==</span> <span class=s>"stepper"</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=k>set</span><span class=p>(</span><span class=s>"basetype"</span><span class=p>,</span> <span class=s>"layout"</span><span class=p>);</span>
        <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=k>set</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>top</span><span class=p>,</span> <span class=m>10</span><span class=p>);</span>
        <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=k>set</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>left</span><span class=p>,</span> <span class=m>10</span><span class=p>);</span>
        <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=k>set</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>width</span><span class=p>,</span> <span class=m>160</span><span class=p>);</span>
        <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=k>set</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>height</span><span class=p>,</span> <span class=m>2</span><span class=p>);</span>
        <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=k>set</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>colour</span><span class=p>,</span> <span class=n>Colours</span><span class=p>::</span><span class=n>white</span><span class=p>.</span><span class=nf>toString</span><span class=p>());</span>
        <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=k>set</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>type</span><span class=p>,</span> <span class=s>"stepper"</span><span class=p>);</span>
        <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=k>set</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>name</span><span class=p>,</span> <span class=s>"stepper"</span><span class=p>);</span>
        <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=k>set</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>name</span><span class=p>,</span> <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=nf>getWithDefault</span><span class=p>(</span><span class=s>"name"</span><span class=p>,</span> <span class=s>""</span><span class=p>).</span><span class=nf>toString</span><span class=p>()+</span><span class=nf>String</span><span class=p>(</span><span class=n>ID</span><span class=p>));</span>
        <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=k>set</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>identchannel</span><span class=p>,</span> <span class=s>""</span><span class=p>);</span>
        <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=k>set</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>visible</span><span class=p>,</span> <span class=m>1</span><span class=p>);</span>
        <span class=c1>//new identifiers
</span>        <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=k>set</span><span class=p>(</span><span class=s>"stepsbpm"</span><span class=p>,</span> <span class=m>60</span><span class=p>);</span>
        <span class=n>cabbageIdentifiers</span><span class=p>.</span><span class=k>set</span><span class=p>(</span><span class=s>"numberofsteps"</span><span class=p>,</span> <span class=m>12</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=p>(...)</span>
</code></pre></div> <h3>Developing our CabbageStepper class.</h3> <p>Now that we have taken care of the two new identifiers, we can get cracking on our stepper widgets. The first thing will need to do is paint a number of &#39;steps&#39;. The number of steps is dynamic and it set by the user. All painting/drawing is done in the widget&#39;s paint(...) method which is passed a Graphics context. To paint something on our widget we can call any number of special painting routines defined in JUCE&#39;s Graphics class. Our simple widget will need to paint some rectangles. To do this will will make some calls to <code>JUCE::Graphics::fillRoundedRectangle(...)</code>. Note that we also create a simple integer array that will hold the current state of each steps. All steps are off by default. </p> <div class=highlight><pre><code class=language-csharp data-lang=csharp><span class=k>class</span> <span class=nc>CabbageStepper</span>    <span class=p>:</span>   <span class=k>public</span> <span class=n>Component</span>
<span class=p>{</span>
    <span class=n>String</span> <span class=n>name</span><span class=p>;</span>
    <span class=kt>float</span> <span class=n>numberOfSteps</span><span class=p>;</span>
    <span class=kt>int</span> <span class=n>stepBPM</span><span class=p>;</span>
    <span class=n>Colour</span> <span class=n>colour</span><span class=p>;</span>
    <span class=n>Array</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;</span> <span class=n>stepStates</span><span class=p>;</span>

    <span class=k>public</span><span class=p>:</span>

    <span class=nf>CabbageStepper</span> <span class=p>(</span><span class=n>CabbageGUIType</span> <span class=p>&amp;</span><span class=n>cAttr</span><span class=p>,</span> <span class=n>CabbagePluginAudioProcessorEditor</span><span class=p>*</span> <span class=n>_owner</span><span class=p>)</span>
        <span class=p>:</span> <span class=nf>Component</span><span class=p>(),</span> 
        <span class=nf>owner</span><span class=p>(</span><span class=n>_owner</span><span class=p>),</span>
        <span class=nf>name</span><span class=p>(</span><span class=n>cAttr</span><span class=p>.</span><span class=nf>getStringProp</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>name</span><span class=p>)),</span>
        <span class=nf>colour</span><span class=p>(</span><span class=n>Colour</span><span class=p>::</span><span class=nf>fromString</span><span class=p>(</span><span class=n>cAttr</span><span class=p>.</span><span class=nf>getStringProp</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>colour</span><span class=p>))),</span>
        <span class=nf>stepBPM</span><span class=p>(</span><span class=n>cAttr</span><span class=p>.</span><span class=nf>getNumProp</span><span class=p>(</span><span class=s>"stepbpm"</span><span class=p>)),</span>
        <span class=nf>numberOfSteps</span><span class=p>(</span><span class=n>cAttr</span><span class=p>.</span><span class=nf>getNumProp</span><span class=p>(</span><span class=s>"numberofsteps"</span><span class=p>))</span>
    <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>=</span><span class=m>0</span><span class=p>;</span><span class=n>i</span><span class=p>&lt;</span><span class=n>numberOfSteps</span><span class=p>;</span><span class=n>i</span><span class=p>++)</span>
            <span class=n>stepStates</span><span class=p>.</span><span class=k>add</span><span class=p>(</span><span class=m>0</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=k>void</span> <span class=nf>paint</span><span class=p>(</span><span class=n>Graphics</span><span class=p>&amp;</span> <span class=n>g</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>g</span><span class=p>.</span><span class=nf>fillAll</span><span class=p>(</span><span class=n>Colours</span><span class=p>::</span><span class=n>transparentBlack</span><span class=p>);</span>
        <span class=kt>float</span> <span class=n>stepWidth</span> <span class=p>=</span> <span class=nf>getWidth</span><span class=p>()/</span><span class=n>numberOfSteps</span><span class=p>;</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>=</span><span class=m>0</span><span class=p>;</span><span class=n>i</span><span class=p>&lt;</span><span class=n>numberOfSteps</span><span class=p>;</span><span class=n>i</span><span class=p>++)</span>
        <span class=p>{</span>
            <span class=n>g</span><span class=p>.</span><span class=nf>setColour</span><span class=p>(</span><span class=n>stepStates</span><span class=p>[</span><span class=n>i</span><span class=p>]==</span><span class=m>1</span> <span class=p>?</span> <span class=n>Colours</span><span class=p>::</span><span class=n>lime</span> <span class=p>:</span> <span class=n>colour</span><span class=p>);</span>
            <span class=n>g</span><span class=p>.</span><span class=nf>fillRoundedRectangle</span><span class=p>(</span><span class=n>stepWidth</span><span class=p>*</span><span class=n>i</span><span class=p>,</span> <span class=nf>getHeight</span><span class=p>()*.</span><span class=m>05</span><span class=p>,</span> <span class=n>stepWidth</span><span class=p>*.</span><span class=m>9</span><span class=p>,</span> <span class=nf>getHeight</span><span class=p>()*.</span><span class=m>9</span><span class=p>,</span> <span class=m>5.f</span><span class=p>);</span> 
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>(...)</span>
</code></pre></div> <p>With the above paint() method, our widget now renders like this.</p> <p><img src="../../images/docs/newWidgetScreen2.png"></p> <p>The next thing to add is the ability to select a step within the sequence. To do this will need to add a mouseDown() method. As the name suggests, a mouseDown() method will check for mouse down events. Users should be able to enable a step in the sequence by clicking on it with the mouse. In order to test for mouse clicks we must override the JUCE::Component::mouseDown(...) method. Each of JUCE&#39;s mouse event methods gets passed a special MouseEvent object that contains information about the mouse event. One can access the current position of the mouse, the number of clicks, the mouse button that was pressed, and lots more besides. </p> <p>In our mouseDown(...) method, we need to check the position of the mouse click. If the user has clicked on a step that is currently disabled, we need to enabled it, otherwise we should disable the step. We also need to call the JUCE::Component::repaint() method once we have dealt with the mouse click. This will cause our widget&#39;s paint method to be caled, so that it can refresh itself. </p> <div class=highlight><pre><code class=language-csharp data-lang=csharp>    <span class=k>void</span> <span class=nf>mouseDown</span><span class=p>(</span><span class=k>const</span> <span class=n>MouseEvent</span><span class=p>&amp;</span> <span class=k>event</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=kt>int</span> <span class=n>x</span> <span class=p>=</span> <span class=k>event</span><span class=p>.</span><span class=nf>getMouseDownX</span><span class=p>();</span>
        <span class=kt>float</span> <span class=n>stepWidth</span> <span class=p>=</span> <span class=nf>getWidth</span><span class=p>()/</span><span class=n>numberOfSteps</span><span class=p>;</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>=</span><span class=m>0</span><span class=p>;</span><span class=n>i</span><span class=p>&lt;</span><span class=n>numberOfSteps</span><span class=p>;</span><span class=n>i</span><span class=p>++)</span>
        <span class=p>{</span>
            <span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=p>&gt;</span><span class=n>i</span><span class=p>*</span><span class=n>stepWidth</span> <span class=p>&amp;&amp;</span> <span class=n>x</span><span class=p>&lt;</span><span class=n>i</span><span class=p>*</span><span class=n>stepWidth</span><span class=p>+</span><span class=n>stepWidth</span><span class=p>)</span>
                <span class=n>stepStates</span><span class=p>.</span><span class=nf>getReference</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=p>=</span> <span class=n>stepStates</span><span class=p>.</span><span class=nf>getReference</span><span class=p>(</span><span class=n>i</span><span class=p>)==</span><span class=m>1</span> <span class=p>?</span> <span class=m>0</span> <span class=p>:</span> <span class=m>1</span><span class=p>;</span>

            <span class=nf>repaint</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
</code></pre></div> <p>Users can now enable/disable steps by clicking on them.</p> <p><img src="../../images/docs/newWidgetClickTest.gif"></p> <p>Right now our stepper widget doesn&#39;t actual &#39;step&#39;, so to speak. In order to step through each, er, step, we need to add some kind of timer. JUCE comes with a very simple Timer class that we can use. We can simple inherit it. The <code>JUCE::Timer</code> class has a pure virtual method that has be overridden. That method is called <code>timerCallback()</code>. This method will be called periodically at a user defined rate. We will set it up to fire at whatever the user has passed to the stepbpm() identifier by passing a timer interval to the <code>startTimer(...)</code> method. </p> <div class=highlight><pre><code class=language-csharp data-lang=csharp><span class=k>class</span> <span class=nc>CabbageStepper</span>    <span class=p>:</span>   <span class=k>public</span> <span class=n>Component</span><span class=p>,</span> <span class=k>public</span> <span class=n>Timer</span>
<span class=p>{</span>
    <span class=n>String</span> <span class=n>name</span><span class=p>;</span>
    <span class=kt>float</span> <span class=n>numberOfSteps</span><span class=p>;</span>
    <span class=kt>int</span> <span class=n>stepBPM</span><span class=p>;</span>
    <span class=n>Colour</span> <span class=n>colour</span><span class=p>;</span>
    <span class=n>Array</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;</span> <span class=n>stepStates</span><span class=p>;</span>

    <span class=k>public</span><span class=p>:</span>

    <span class=nf>CabbageStepper</span> <span class=p>(</span><span class=n>CabbageGUIType</span> <span class=p>&amp;</span><span class=n>cAttr</span><span class=p>,</span> <span class=n>CabbagePluginAudioProcessorEditor</span><span class=p>*</span> <span class=n>_owner</span><span class=p>)</span>
        <span class=p>:</span> <span class=nf>Component</span><span class=p>(),</span> 
        <span class=nf>owner</span><span class=p>(</span><span class=n>_owner</span><span class=p>),</span>
        <span class=nf>name</span><span class=p>(</span><span class=n>cAttr</span><span class=p>.</span><span class=nf>getStringProp</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>name</span><span class=p>)),</span>
        <span class=nf>colour</span><span class=p>(</span><span class=n>Colour</span><span class=p>::</span><span class=nf>fromString</span><span class=p>(</span><span class=n>cAttr</span><span class=p>.</span><span class=nf>getStringProp</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>colour</span><span class=p>))),</span>
        <span class=nf>stepBPM</span><span class=p>(</span><span class=n>cAttr</span><span class=p>.</span><span class=nf>getNumProp</span><span class=p>(</span><span class=s>"stepbpm"</span><span class=p>)),</span>
        <span class=nf>numberOfSteps</span><span class=p>(</span><span class=n>cAttr</span><span class=p>.</span><span class=nf>getNumProp</span><span class=p>(</span><span class=s>"numberofsteps"</span><span class=p>))</span>
    <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>=</span><span class=m>0</span><span class=p>;</span><span class=n>i</span><span class=p>&lt;</span><span class=n>numberOfSteps</span><span class=p>;</span><span class=n>i</span><span class=p>++)</span>
            <span class=n>stepStates</span><span class=p>.</span><span class=k>add</span><span class=p>(</span><span class=m>0</span><span class=p>);</span>

        <span class=nf>startTimer</span><span class=p>((</span><span class=m>60</span><span class=p>/</span><span class=n>stepBPM</span><span class=p>)*</span><span class=m>1000</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=k>void</span> <span class=nf>timerCallback</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=n>cUtils</span><span class=p>::</span><span class=nf>debug</span><span class=p>(</span><span class=s>"I'm stepping!!"</span><span class=p>);</span>
    <span class=p>}</span>
</code></pre></div> <p>Now that we have a timer going, we need to provide the user with some kind of visual indicator as to the current step. There are several ways to do this. We could for example colour the current step so that it is different from the others. But this might lead to some confusion when the current step matches one of the selected steps. In this case it may be best to dynamically resize the current step so that it is slightly larger than the others. This is quite simple to do. We simply create a currentStep variable that will hold the currentStep index, and modify our paint routine so that it paints the current step larger than the others. </p> <div class=highlight><pre><code class=language-csharp data-lang=csharp><span class=k>class</span> <span class=nc>CabbageStepper</span>    <span class=p>:</span>   <span class=k>public</span> <span class=n>Component</span><span class=p>,</span> <span class=k>public</span> <span class=n>Timer</span>
<span class=p>{</span>
    <span class=n>String</span> <span class=n>name</span><span class=p>;</span>
    <span class=kt>float</span> <span class=n>numberOfSteps</span><span class=p>;</span>
    <span class=kt>int</span> <span class=n>stepBPM</span><span class=p>,</span> <span class=n>currentStep</span><span class=p>;</span>
    <span class=n>Colour</span> <span class=n>colour</span><span class=p>;</span>
    <span class=n>Array</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;</span> <span class=n>stepStates</span><span class=p>;</span>

    <span class=k>public</span><span class=p>:</span>

    <span class=nf>CabbageStepper</span> <span class=p>(</span><span class=n>CabbageGUIType</span> <span class=p>&amp;</span><span class=n>cAttr</span><span class=p>,</span> <span class=n>CabbagePluginAudioProcessorEditor</span><span class=p>*</span> <span class=n>_owner</span><span class=p>)</span>
        <span class=p>:</span> <span class=nf>Component</span><span class=p>(),</span> 
        <span class=nf>owner</span><span class=p>(</span><span class=n>_owner</span><span class=p>),</span>
        <span class=nf>name</span><span class=p>(</span><span class=n>cAttr</span><span class=p>.</span><span class=nf>getStringProp</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>name</span><span class=p>)),</span>
        <span class=nf>colour</span><span class=p>(</span><span class=n>Colour</span><span class=p>::</span><span class=nf>fromString</span><span class=p>(</span><span class=n>cAttr</span><span class=p>.</span><span class=nf>getStringProp</span><span class=p>(</span><span class=n>CabbageIDs</span><span class=p>::</span><span class=n>colour</span><span class=p>))),</span>
        <span class=nf>stepBPM</span><span class=p>(</span><span class=n>cAttr</span><span class=p>.</span><span class=nf>getNumProp</span><span class=p>(</span><span class=s>"stepbpm"</span><span class=p>)),</span>
        <span class=nf>numberOfSteps</span><span class=p>(</span><span class=n>cAttr</span><span class=p>.</span><span class=nf>getNumProp</span><span class=p>(</span><span class=s>"numberofsteps"</span><span class=p>)),</span>
        <span class=nf>currentStep</span><span class=p>(</span><span class=m>0</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>=</span><span class=m>0</span><span class=p>;</span><span class=n>i</span><span class=p>&lt;</span><span class=n>numberOfSteps</span><span class=p>;</span><span class=n>i</span><span class=p>++)</span>
            <span class=n>stepStates</span><span class=p>.</span><span class=k>add</span><span class=p>(</span><span class=m>0</span><span class=p>);</span>

        <span class=nf>startTimer</span><span class=p>((</span><span class=m>60</span><span class=p>/</span><span class=n>stepBPM</span><span class=p>)*</span><span class=m>1000</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=k>void</span> <span class=nf>timerCallback</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=n>currentStep</span> <span class=p>=</span> <span class=n>currentStep</span><span class=p>&lt;</span><span class=m>11</span> <span class=p>?</span> <span class=n>currentStep</span><span class=p>+</span><span class=m>1</span> <span class=p>:</span> <span class=m>0</span><span class=p>;</span>
        <span class=nf>repaint</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=k>void</span> <span class=nf>paint</span><span class=p>(</span><span class=n>Graphics</span><span class=p>&amp;</span> <span class=n>g</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>g</span><span class=p>.</span><span class=nf>fillAll</span><span class=p>(</span><span class=n>Colours</span><span class=p>::</span><span class=n>transparentBlack</span><span class=p>);</span>
        <span class=kt>float</span> <span class=n>scaleSize</span><span class=p>,</span> <span class=n>scaleTop</span><span class=p>;</span>
        <span class=kt>float</span> <span class=n>stepWidth</span> <span class=p>=</span> <span class=nf>getWidth</span><span class=p>()/</span><span class=n>numberOfSteps</span><span class=p>;</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>=</span><span class=m>0</span><span class=p>;</span><span class=n>i</span><span class=p>&lt;</span><span class=n>numberOfSteps</span><span class=p>;</span><span class=n>i</span><span class=p>++)</span>
        <span class=p>{</span>
            <span class=n>g</span><span class=p>.</span><span class=nf>setColour</span><span class=p>(</span><span class=n>stepStates</span><span class=p>[</span><span class=n>i</span><span class=p>]==</span><span class=m>1</span> <span class=p>?</span> <span class=n>Colours</span><span class=p>::</span><span class=n>lime</span> <span class=p>:</span> <span class=n>colour</span><span class=p>);</span>
            <span class=n>scaleSize</span> <span class=p>=</span> <span class=n>currentStep</span><span class=p>==</span><span class=n>i</span> <span class=p>?</span> <span class=p>.</span><span class=m>95</span> <span class=p>:</span> <span class=p>.</span><span class=m>9</span><span class=p>;</span>
            <span class=n>scaleTop</span> <span class=p>=</span> <span class=n>currentStep</span><span class=p>==</span><span class=n>i</span> <span class=p>?</span> <span class=p>.</span><span class=m>025</span> <span class=p>:</span> <span class=p>.</span><span class=m>05</span><span class=p>;</span>

            <span class=n>g</span><span class=p>.</span><span class=nf>fillRoundedRectangle</span><span class=p>(</span><span class=n>stepWidth</span><span class=p>*</span><span class=n>i</span><span class=p>,</span> <span class=nf>getHeight</span><span class=p>()*</span><span class=n>scaleTop</span><span class=p>,</span> <span class=n>stepWidth</span><span class=p>*</span><span class=n>scaleSize</span><span class=p>,</span> <span class=nf>getHeight</span><span class=p>()*</span><span class=n>scaleSize</span><span class=p>,</span> <span class=m>5.f</span><span class=p>);</span> 
        <span class=p>}</span>
    <span class=p>}</span>
   <span class=p>(...)</span>
</code></pre></div> <p>Now the user can clearly see which is the current step in the sequence.</p> <p><img src="../../images/docs/newWidgetTimerTest.gif"></p> </div> </article> <div class=doc-link-wrapper> <a href="../new_widgets_part_1/index.html" class="doc-link left-link" title="Previous Doc"><i class="icon icon-left-open"></i></a> <a href="../new_widgets_part_3/index.html" class="doc-link right-link" title="Next Doc"><i class="icon icon-right-open"></i></a> </div> <div class=clear></div> </div> </div> </div> <a href="index.html#0" class=back-to-top></a> <script src="../../scripts/vendor.js"></script> <script src="../../scripts/main.js"></script>  <script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='https://www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create','UA-74283643-1');ga('send','pageview');
    </script> </body> </html> 